basePath: /api
definitions:
  github_com_moasq_go-b2b-starter_internal_modules_billing_domain.BillingStatus:
    properties:
      canProcessInvoices:
        type: boolean
      checkedAt:
        type: string
      externalID:
        type: string
      hasActiveSubscription:
        type: boolean
      invoiceCount:
        description: Remaining invoices
        format: int32
        type: integer
      organizationID:
        format: int32
        type: integer
      reason:
        type: string
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_cognitive_domain.ChatMessage:
    properties:
      content:
        type: string
      created_at:
        type: string
      id:
        type: integer
      referenced_docs:
        items:
          type: integer
        type: array
      role:
        $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_cognitive_domain.ChatRole'
      session_id:
        type: integer
      tokens_used:
        type: integer
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_cognitive_domain.ChatResponse:
    properties:
      message:
        $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_cognitive_domain.ChatMessage'
      referenced_docs:
        items:
          $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_cognitive_domain.SimilarDocument'
        type: array
      session_id:
        type: integer
      tokens_used:
        type: integer
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_cognitive_domain.ChatRole:
    enum:
    - user
    - assistant
    - system
    type: string
    x-enum-varnames:
    - ChatRoleUser
    - ChatRoleAssistant
    - ChatRoleSystem
  github_com_moasq_go-b2b-starter_internal_modules_cognitive_domain.SimilarDocument:
    properties:
      chunk_index:
        type: integer
      content_hash:
        type: string
      content_preview:
        type: string
      created_at:
        type: string
      document_id:
        type: integer
      embedding:
        description: 1536 dimensions for OpenAI
        items:
          type: number
        type: array
      id:
        type: integer
      organization_id:
        type: integer
      similarity_score:
        type: number
      updated_at:
        type: string
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_documents_app_services.ListDocumentsResponse:
    properties:
      documents:
        items:
          $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_documents_domain.Document'
        type: array
      limit:
        type: integer
      offset:
        type: integer
      total:
        type: integer
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_documents_domain.Document:
    properties:
      content_type:
        type: string
      created_at:
        type: string
      extracted_text:
        type: string
      file_asset_id:
        type: integer
      file_name:
        type: string
      file_size:
        type: integer
      id:
        type: integer
      metadata:
        additionalProperties: true
        type: object
      organization_id:
        type: integer
      status:
        $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_documents_domain.DocumentStatus'
      title:
        type: string
      updated_at:
        type: string
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_documents_domain.DocumentStatus:
    enum:
    - pending
    - processing
    - processed
    - failed
    type: string
    x-enum-varnames:
    - DocumentStatusPending
    - DocumentStatusProcessing
    - DocumentStatusProcessed
    - DocumentStatusFailed
  github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.AddMemberResponse:
    properties:
      email:
        type: string
      invite_sent:
        type: boolean
      member_id:
        type: string
      name:
        type: string
      org_id:
        type: string
      role_slug:
        type: string
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.BootstrapOrganizationRequest:
    properties:
      org_display_name:
        description: Organization details
        type: string
      owner_email:
        description: Owner member details
        type: string
      owner_name:
        type: string
    required:
    - org_display_name
    - owner_email
    - owner_name
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.BootstrapOrganizationResponse:
    properties:
      display_name:
        type: string
      invite_sent:
        type: boolean
      magic_link_sent:
        type: boolean
      org_slug:
        type: string
      organization_id:
        type: string
      owner_email:
        type: string
      owner_member_id:
        type: string
      owner_name:
        type: string
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.ListMembersResponse:
    properties:
      members:
        items:
          $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.MemberInfo'
        type: array
      total:
        type: integer
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.MemberInfo:
    properties:
      created_at:
        type: string
      email:
        type: string
      email_verified:
        type: boolean
      member_id:
        type: string
      name:
        type: string
      roles:
        items:
          type: string
        type: array
      status:
        type: string
      updated_at:
        type: string
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.ProfileOrganization:
    properties:
      name:
        type: string
      organization_id:
        type: string
      slug:
        type: string
      status:
        type: string
    type: object
  github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.ProfileResponse:
    properties:
      account_id:
        description: Internal account details
        type: integer
      created_at:
        type: string
      email:
        type: string
      email_verified:
        type: boolean
      member_id:
        description: Auth provider member details
        type: string
      name:
        type: string
      organization:
        allOf:
        - $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.ProfileOrganization'
        description: Organization details
      permissions:
        items:
          type: string
        type: array
      roles:
        items:
          type: string
        type: array
      status:
        type: string
      updated_at:
        type: string
    type: object
  github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError:
    properties:
      code:
        type: string
      message:
        type: string
    type: object
  internal_modules_auth.PermissionCheckRequest:
    properties:
      permission_id:
        type: string
      role_id:
        type: string
    required:
    - permission_id
    - role_id
    type: object
  internal_modules_auth.PermissionCheckResponse:
    properties:
      has_permission:
        type: boolean
      permission_id:
        type: string
      role_id:
        type: string
    type: object
  internal_modules_auth.PermissionDTO:
    properties:
      action:
        type: string
      category:
        type: string
      description:
        type: string
      display_name:
        type: string
      id:
        type: string
      resource:
        type: string
    type: object
  internal_modules_auth.PermissionsByCategoryResponse:
    properties:
      categories:
        additionalProperties:
          items:
            $ref: '#/definitions/internal_modules_auth.PermissionDTO'
          type: array
        type: object
    type: object
  internal_modules_auth.PermissionsResponse:
    properties:
      permissions:
        items:
          $ref: '#/definitions/internal_modules_auth.PermissionDTO'
        type: array
    type: object
  internal_modules_auth.RBACMetadata:
    properties:
      description:
        type: string
      permissions_by_role:
        additionalProperties:
          type: integer
        type: object
      total_permissions:
        type: integer
      total_roles:
        type: integer
    type: object
  internal_modules_auth.RoleDTO:
    properties:
      description:
        type: string
      id:
        type: string
      name:
        type: string
      permissions:
        items:
          $ref: '#/definitions/internal_modules_auth.PermissionDTO'
        type: array
    type: object
  internal_modules_auth.RolePermissionsResponse:
    properties:
      restrictions:
        $ref: '#/definitions/internal_modules_auth.RoleRestrictions'
      role:
        $ref: '#/definitions/internal_modules_auth.RoleDTO'
      statistics:
        $ref: '#/definitions/internal_modules_auth.RoleStatistics'
    type: object
  internal_modules_auth.RoleRestrictions:
    properties:
      cannot_do:
        items:
          type: string
        type: array
      data_access_level:
        type: string
      scope:
        type: string
    type: object
  internal_modules_auth.RoleStatistics:
    properties:
      can_approve:
        type: boolean
      can_manage_org:
        type: boolean
      description:
        type: string
      total_permissions:
        type: integer
    type: object
  internal_modules_auth.RolesResponse:
    properties:
      roles:
        items:
          $ref: '#/definitions/internal_modules_auth.RoleDTO'
        type: array
    type: object
  internal_modules_billing.VerifyPaymentRequest:
    properties:
      session_id:
        type: string
    required:
    - session_id
    type: object
  internal_modules_cognitive.ChatRequest:
    properties:
      context_history:
        type: integer
      max_documents:
        type: integer
      message:
        type: string
      session_id:
        type: integer
      use_rag:
        type: boolean
    required:
    - message
    type: object
externalDocs:
  description: OpenAPI
  url: https://swagger.io/resources/open-api/
host: localhost:8080
info:
  contact:
    email: support@swagger.io
    name: API Support
    url: http://www.swagger.io/support
  description: This is the API server for B2B SaaS Starter.
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  termsOfService: http://swagger.io/terms/
  title: B2B SaaS Starter API
  version: "1.0"
paths:
  /api/subscriptions/status:
    get:
      consumes:
      - application/json
      description: Retrieve the current subscription billing status and invoice quota
        information for the organization
      produces:
      - application/json
      responses:
        "200":
          description: Current billing and quota status
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_billing_domain.BillingStatus'
        "400":
          description: Invalid request parameters or missing organization context
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
      summary: Get current billing and quota status
      tags:
      - subscriptions
  /api/subscriptions/verify-payment:
    post:
      consumes:
      - application/json
      description: Verifies a payment by checking the Polar checkout session and updates
        subscription status. This is the primary mechanism for "Verification on Redirect"
        pattern when user returns from payment page.
      parameters:
      - description: Checkout session ID
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/internal_modules_billing.VerifyPaymentRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Verification result with updated billing status
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_billing_domain.BillingStatus'
        "400":
          description: Invalid request parameters or checkout session failed
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
        "404":
          description: Checkout session not found
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
      summary: Verify payment from checkout session
      tags:
      - subscriptions
  /auth/check-email:
    get:
      consumes:
      - application/json
      description: Checks if an email exists in any organization. Returns 200 OK (empty
        response) if exists, 404 Not Found if doesn't exist. This is a public endpoint
        used during login flow.
      parameters:
      - description: Email address to check
        in: query
        name: email
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Email exists
        "400":
          description: Invalid email format
          schema:
            additionalProperties: true
            type: object
        "404":
          description: Email not found
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties: true
            type: object
      summary: Check if email exists
      tags:
      - auth
  /auth/members:
    get:
      consumes:
      - application/json
      description: Retrieves all members of the current organization. Restricted to
        admin role only.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.ListMembersResponse'
        "400":
          description: Missing organization context
          schema:
            additionalProperties: true
            type: object
        "403":
          description: Insufficient permissions - admin role required
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Failed to list members
          schema:
            additionalProperties: true
            type: object
      summary: List organization members
      tags:
      - auth
    post:
      consumes:
      - application/json
      description: 'Adds a new member to an existing organization with a specified
        role. Organization ID is automatically extracted from JWT token. Member receives
        a magic link invite email for passwordless authentication. Request body: {"email":
        "user@example.com", "name": "Full Name", "role_slug": "member"}'
      parameters:
      - description: Bearer JWT token
        in: header
        name: Authorization
        required: true
        type: string
      - description: Member email address
        in: body
        name: email
        required: true
        schema:
          type: string
      - description: Member full name
        in: body
        name: name
        required: true
        schema:
          type: string
      - description: Role slug (defaults to 'member')
        in: body
        name: role_slug
        schema:
          type: string
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.AddMemberResponse'
        "400":
          description: Invalid request payload or missing organization context
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Failed to add member
          schema:
            additionalProperties: true
            type: object
      summary: Add member to organization
      tags:
      - auth
  /auth/members/{member_id}:
    delete:
      consumes:
      - application/json
      description: Removes a member from the organization (deletes from both Stytch
        and internal database). Only admins can delete members.
      parameters:
      - description: Bearer JWT token
        in: header
        name: Authorization
        required: true
        type: string
      - description: Member ID to delete
        in: path
        name: member_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: Member deleted successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid member ID or missing organization context
          schema:
            additionalProperties: true
            type: object
        "403":
          description: Insufficient permissions - admin role required
          schema:
            additionalProperties: true
            type: object
        "404":
          description: Member not found
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Failed to delete member
          schema:
            additionalProperties: true
            type: object
      summary: Delete organization member
      tags:
      - auth
  /auth/profile/me:
    get:
      consumes:
      - application/json
      description: Retrieves comprehensive profile information for the currently authenticated
        user, including member details, organization info, and account status.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.ProfileResponse'
        "400":
          description: Missing required context (organization or claims)
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Authentication required
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Failed to retrieve profile
          schema:
            additionalProperties: true
            type: object
      summary: Get current user profile
      tags:
      - auth
  /auth/signup:
    post:
      consumes:
      - application/json
      description: Creates a new organization in Stytch with an initial admin member.
        The admin receives a magic link invite email to complete passwordless onboarding.
        Organization slug is auto-generated from the organization name.
      parameters:
      - description: Organization bootstrap request (passwordless - no password required)
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.BootstrapOrganizationRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_organizations_app_services.BootstrapOrganizationResponse'
        "400":
          description: Invalid request payload
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Failed to bootstrap organization
          schema:
            additionalProperties: true
            type: object
      summary: Bootstrap organization
      tags:
      - auth
  /example_cognitive/chat:
    post:
      consumes:
      - application/json
      description: Sends a message to the AI and gets a response, optionally using
        RAG
      parameters:
      - description: Chat request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/internal_modules_cognitive.ChatRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_cognitive_domain.ChatResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
      summary: Chat with AI
      tags:
      - Cognitive
  /example_cognitive/sessions:
    get:
      description: Lists chat sessions for the current user with pagination
      parameters:
      - default: 10
        description: Limit
        in: query
        name: limit
        type: integer
      - default: 0
        description: Offset
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
      summary: List chat sessions
      tags:
      - Cognitive
  /example_cognitive/sessions/{id}/messages:
    get:
      description: Retrieves all messages for a chat session
      parameters:
      - description: Session ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_cognitive_domain.ChatMessage'
            type: array
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
      summary: Get session history
      tags:
      - Cognitive
  /example_documents:
    get:
      description: Lists documents with optional filtering and pagination
      parameters:
      - default: 10
        description: Limit
        in: query
        name: limit
        type: integer
      - default: 0
        description: Offset
        in: query
        name: offset
        type: integer
      - description: Filter by status (pending, processing, processed, failed)
        in: query
        name: status
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_documents_app_services.ListDocumentsResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
      summary: List documents
      tags:
      - Documents
  /example_documents/{id}:
    delete:
      description: Deletes a document and its associated file
      parameters:
      - description: Document ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
      summary: Delete document
      tags:
      - Documents
  /example_documents/upload:
    post:
      consumes:
      - multipart/form-data
      description: Uploads a PDF document, extracts text, and creates embeddings
      parameters:
      - description: PDF file to upload
        in: formData
        name: file
        required: true
        type: file
      - description: Document title
        in: formData
        name: title
        required: true
        type: string
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_internal_modules_documents_domain.Document'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/github_com_moasq_go-b2b-starter_pkg_httperr.HTTPError'
      summary: Upload PDF document
      tags:
      - Documents
  /rbac/check-permission:
    post:
      consumes:
      - application/json
      description: Verifies whether a role has been granted a specific permission.
        Useful for conditional UI rendering.
      parameters:
      - description: Role and permission to check
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/internal_modules_auth.PermissionCheckRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Permission check result
          schema:
            $ref: '#/definitions/internal_modules_auth.PermissionCheckResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Check if a role has a specific permission
      tags:
      - RBAC
  /rbac/metadata:
    get:
      description: Returns summary information about the RBAC system including total
        roles, permissions, and categories.
      produces:
      - application/json
      responses:
        "200":
          description: RBAC system metadata
          schema:
            $ref: '#/definitions/internal_modules_auth.RBACMetadata'
      summary: Get RBAC system metadata
      tags:
      - RBAC
  /rbac/permissions:
    get:
      description: Returns all available permissions in the system. Each permission
        includes resource, action, display name, and description for frontend rendering.
      produces:
      - application/json
      responses:
        "200":
          description: All permissions
          schema:
            $ref: '#/definitions/internal_modules_auth.PermissionsResponse'
        "500":
          description: Internal error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get all permissions
      tags:
      - RBAC
  /rbac/permissions/by-category:
    get:
      description: Returns all permissions organized by their category for better
        UI organization.
      produces:
      - application/json
      responses:
        "200":
          description: Permissions by category
          schema:
            $ref: '#/definitions/internal_modules_auth.PermissionsByCategoryResponse'
        "500":
          description: Internal error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get permissions grouped by category
      tags:
      - RBAC
  /rbac/roles:
    get:
      description: Returns all available roles in the system with their associated
        permissions. This is the single source of truth for frontend role/permission
        discovery.
      produces:
      - application/json
      responses:
        "200":
          description: Roles with permissions
          schema:
            $ref: '#/definitions/internal_modules_auth.RolesResponse'
        "500":
          description: Internal error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get all roles with permissions
      tags:
      - RBAC
  /rbac/roles/{role_id}:
    get:
      description: Returns comprehensive information about a role including permissions,
        statistics, and restrictions.
      parameters:
      - description: Role ID (member, approver, admin)
        in: path
        name: role_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Role details with statistics
          schema:
            $ref: '#/definitions/internal_modules_auth.RolePermissionsResponse'
        "400":
          description: Invalid role ID
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Role not found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get detailed information about a specific role
      tags:
      - RBAC
securityDefinitions:
  BasicAuth:
    type: basic
swagger: "2.0"
